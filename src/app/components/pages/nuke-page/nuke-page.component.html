<div class="nuke-page-container">
    <div class="widget-container">
        <app-nuke-counter [showButton]="false" style="margin-top: auto; margin-bottom: auto;"/>
        <app-nuke-stats style="margin-top: auto; margin-bottom: auto;"></app-nuke-stats>
        @if (this.pieChartOptions$ | async; as pieChartNukes) {
            <div echarts [options]="pieChartNukes" class="nuke-pie-chart"></div>
        }
    </div>
    <div class="nuke-table">
        <div class="table-header">
            <span class="header-text">Dropped Nukes</span>
            <div class="filter-container">
                <span class="filter-label">Nuke Type:</span>
                <p-multiSelect 
                    [(ngModel)]="this.filterNukeType" 
                    [options]="(this.nukeTypes$ | async)!"
                    dataKey="id"
                    placeholder="Any" 
                    (onChange)="updateFilter($event.value)"
                    [showClear]="true"
                    optionLabel="name"
                    appendTo="body"
                >
                </p-multiSelect>
            </div>
        </div>
        @if (this.displayNukeDrops$ | async; as nuke_drops) {
            <p-table 
                [value]="nuke_drops" 
                sortField="date" [sortOrder]="-1"
                [first]="this.nukeTableFirst"
                [rows]="this.nukeTableRows"
                [paginator]="true"
                [alwaysShowPaginator]="false"
                paginatorStyleClass="hidden-paginator"
            >
                <ng-template pTemplate="header">
                    <tr>
                        <th pSortableColumn="date" style="width: 16rem;">
                            Date <p-sortIcon field="date" />
                        </th>
                        <th>Type</th>
                        <th>Location</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-drop>
                    <tr>
                        <td>
                            @if(drop.date){
                                {{ drop.date | momentDate: DATE_FORMAT }}
                            }
                            @else {
                                <span class="unknown-table-value">Unknown</span>
                            }
                        </td>
                        <td>
                            @if(drop.nukeType){
                                {{ drop.nukeType.name }}
                            }
                            @else {
                                <span class="unknown-table-value">Unknown</span>
                            }
                        </td>
                        <td>
                            @if(drop.dropLocation){
                                {{ drop.dropLocation }}
                            }
                            @else {
                                <span class="unknown-table-value">Unknown</span>
                            }
                        </td>
                    </tr>
                </ng-template>
            </p-table>
            <div class="paginator-container">
                <p-paginator
                    [first]="this.nukeTableFirst"
                    [rows]="this.nukeTableRows" 
                    [totalRecords]="nuke_drops.length"
                    (onPageChange)="onPageChange($event)"
                />
            </div>
        }
    </div>
</div>
<p-button class="fab-button" icon="pi pi-plus" [rounded]="true" severity="success" size="large" pTooltip="Add Nuke Drop" (onClick)="openAddNuke()"/>
<app-add-nuke-dialog></app-add-nuke-dialog>